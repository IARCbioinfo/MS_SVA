---
title: "Signature Variability Analysis of the mutational signatures of driver alterations with sigvar"
author:
  - name: "Nicolas Alcala"
    affiliation: "Rare Cancers Genomics Team, International Agency for Research on Cancer / World Health Organization"
    email: "alcalan@iarc.who.int"
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    toc: true
    toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Mutational signatures of carcinogens}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(FAVA)
library(sigvar)
library(ggplot2)
library(stringr)
library(dplyr)
library(readr)
library(readxl)
library(patchwork)
library(ggpubr)
library(lmerPerm)
```

# Introduction

This vignette details an example of using sigvar to analyse the relationship between variability of mutational signatures and driver alterations. It relies on the computation of the probability of driver mutations given a samples' single base substition (SBS) mutational spectrum and a cancer gene's spectrum of driver alterations.

# Datasets
This vignettes analyses the intogen dataset included in the sigvar package. For each dataset, we need three objects:
- the relative SBS signature activities of all *n* samples, (table "_SBS"), with *n* rows and *k* columns, where *k* the number of active signatures in the dataset
- the reference signature definitions (table "_SBS.refs"), with 96 rows corresponding to the usual SBS channels and *k* columns corresponding to the active signatures
- the SBS spectrum of known driver alterations in relevant driver genes ("_drivers_SBS" ), with 96 rows corresponding to the usual SBS channels, and *d* rows corresponding to the driver genes considered

## Lung cancer in never smokers (LCINS)
The first dataset consists of mutational signatures of lung cancer in never smokers (LCINS) from the Sherlock-Lung study (Zhang et al. 2021)
```{r }
Sherlock_LCINS_SBS
Sherlock_LCINS_SBS.refs
LUAD_drivers_SBS
```

## Mice exposed to 20 known or suspected carcinogens
We will also investigate the mutational spectra of drivers from mice exposed or non-exposed to carcinogens from Riva et al. 2020
```{r }
carcinogens_mice_SBS
carcinogens_mice_SBS.refs
mice_lung_drivers_SBS
mice_liver_drivers_SBS
```

## ESCC across countries
We finally investigate the mutational spectra of drivers from countries with varying incidence of esophageal squamous cell carcinoma from Moody et al. 2021
```{r }
ESCC_countries_SBS
ESCC_countries_SBS.refs
ESCC_drivers_SBS
```

## Data preparation
We compute the expected SBS profiles of each sample based on their signature attributions, by computing the linear combination of signatures observed in a sample weighted by their relative attribution in that sample.

## LCINS
```{r}
MutType = Sherlock_LCINS_SBS.refs %>% dplyr::select(Type,Subtype)

Sherlock_LCINS_SBS_spectra = as.matrix(Sherlock_LCINS_SBS[,-1])%*%t(as.matrix(Sherlock_LCINS_SBS.refs %>% dplyr::select(-Type,-Subtype) ))

rownames(Sherlock_LCINS_SBS_spectra) = Sherlock_LCINS_SBS$Sample
colnames(Sherlock_LCINS_SBS_spectra) = paste0(MutType$Type,",",MutType$Subtype)
```

## ESCC across continents
```{r}
ESCC_countries_SBS_spectra = as.matrix(ESCC_countries_SBS[,-(1:3)])%*%t(as.matrix(ESCC_countries_SBS.refs %>% dplyr::select(-Type,-Subtype)))

rownames(ESCC_countries_SBS_spectra) = ESCC_countries_SBS$Sample
colnames(ESCC_countries_SBS_spectra) = paste0(MutType$Type,",",MutType$Subtype)
```

## Riva et al. samples
```{r}
carcinogens_mice_SBS_spectra = as.matrix(carcinogens_mice_SBS[,2:12])%*%t(as.matrix(carcinogens_mice_SBS.refs %>% dplyr::select(-Type,-Subtype)))

rownames(carcinogens_mice_SBS_spectra) = carcinogens_mice_SBS$Sample
colnames(carcinogens_mice_SBS_spectra) = paste0(MutType$Type,",",MutType$Subtype)
```

# Computing the probability of driver mutations
For each dataset, cancer gene, and patient, we compute the probability of a driver mutations as the dot product of the SBS spectrum of a patient (rows of tables "_SBS_spectra") and the SBS spectrum of driver mutations for this cancer gene (columns of tables "_drivers_SBS").

## Compute driver spectra
```{r}

```

## LCINS
For LCINS we focus on the two most frequently mutated genes, *EGFR* and *TP53*.
### EGFR
```{r}
prob_Sherlock_EGFR_drivers = sapply(1:nrow(Sherlock_MutProf_LUAD), function(i) Sherlock_MutProf_LUAD[i,]%*%(LUAD_drivers_SBS$EGFR) )
```

### TP53
```{r}
prob_Sherlock_TP53_drivers = sapply(1:nrow(Sherlock_MutProf_LUAD), function(i) Sherlock_MutProf_LUAD[i,]%*%(LUAD_drivers_SBS$TP53) )
```

## ESCC across countries
```{r}
prob_ESCC_TP53_drivers = sapply(1:nrow(ESCC_MutProf), function(i) ESCC_MutProf[i,]%*%ESCC_drivers_SBS$TP53 )
prob_ESCC_CDKN2A_drivers = sapply(1:nrow(ESCC_MutProf), function(i) ESCC_MutProf[i,]%*%(ESCC_drivers_SBS$CDKN2A) )
prob_ESCC_EP300_drivers = sapply(1:nrow(ESCC_MutProf), function(i) ESCC_MutProf[i,]%*%(ESCC_drivers_SBS$EP300) )
prob_ESCC_KMT2D_drivers = sapply(1:nrow(ESCC_MutProf), function(i) ESCC_MutProf[i,]%*%(ESCC_drivers_SBS$KMT2D) )
prob_ESCC_NFE2L2_drivers = sapply(1:nrow(ESCC_MutProf), function(i) ESCC_MutProf[i,]%*%(ESCC_drivers_SBS$NFE2L2) )
prob_ESCC_NOTCH1_drivers = sapply(1:nrow(ESCC_MutProf), function(i) ESCC_MutProf[i,]%*%(ESCC_drivers_SBS$NOTCH1) )
prob_ESCC_PIK3CA_drivers = sapply(1:nrow(ESCC_MutProf), function(i) ESCC_MutProf[i,]%*%(ESCC_drivers_SBS$PIK3CA) )
```

## Mice exposed to 20 carcinogens
Probability of mutation in 186 drivers for each of 181 individuals
```{r}
prob_carcinogens_mice_drivers.lung.Kras = sapply(1:nrow(carcinogens_mice_SBS_spectra), function(i) carcinogens_mice_SBS_spectra[i,]%*%mice_lung_drivers_SBS$Kras)
prob_carcinogens_mice_drivers.lung.Fgfr2 = sapply(1:nrow(carcinogens_mice_SBS_spectra), function(i) carcinogens_mice_SBS_spectra[i,]%*% mice_lung_drivers_SBS$Fgfr2)
prob_carcinogens_mice_drivers.liver.Hras = sapply(1:nrow(carcinogens_mice_SBS_spectra), function(i) carcinogens_mice_SBS_spectra[i,]%*% mice_liver_drivers_SBS$Hras)
prob_carcinogens_mice_drivers.liver.Braf = sapply(1:nrow(carcinogens_mice_SBS_spectra), function(i) carcinogens_mice_SBS_spectra[i,]%*% mice_liver_drivers_SBS$Braf)
```


# Computing variability statistics 
For each dataset, we first compute the cosine similarities between mutational signatures, which we will use to weight the differences between signature such that profiles with plenty of similar signatures are not deemed diverse.

## 
```{r}
cossim <- function(refs){
  res = t(refs)%*%refs/matrix(sqrt(colSums(refs**2)),nrow = ncol(refs),ncol=ncol(refs))/matrix(sqrt(colSums(refs**2)),nrow = ncol(refs),ncol=ncol(refs),byrow = T)
  diag(res)=1 
  return(res)
}
```

## LCINS samples
```{r }
Sherlock_LCINS_SBS_S_cossim <- cossim(refs = as.matrix(Sherlock_LCINS_SBS.refs[,1:14]))
```

```{r }
Sherlock_LCINS_SBS_GS = sapply(1:nrow(Sherlock_LCINS_SBS), function(i) gini_simpson(Sherlock_LCINS_SBS[i,-1], S=Sherlock_LCINS_SBS_S_cossim) )
```

## Mice samples
```{r }
carcinogens_mice_SBS_S_cossim <- cossim(refs = as.matrix(carcinogens_mice_SBS.refs[,1:11]) )
```

```{r }
carcinogens_mice_SBS_GS= sapply(1:nrow(carcinogens_mice_SBS), function(i) gini_simpson(carcinogens_mice_SBS[i,1:11+1], S=carcinogens_mice_SBS_GS) )
```

## ESCC across continents samples
Note that in this case we do not use the similarity matrix S, for consistency with other analyses of this dataset.
```{r}
ESCC_countries_SBS_GS = sapply(1:nrow(ESCC_countries_SBS), function(i) gini_simpson(ESCC_countries_SBS[i,1:28+3]) )
```

# Testing the relationship
Test the relationship between probability of driver mutations and within-tumor variability

## LCINS
```{r }
Sherlock_LCINS_SBS_res = bind_cols(prob.EGFR=prob_Sherlock_EGFR_drivers, prob.TP53=prob_Sherlock_TP53_drivers  ,
                                   GS=Sherlock_LCINS_SBS_GS,
                                   Tumor_Purity=Sherlock_LCINS.metadata$Tumor_Purity,
                                   Tumor_Ploidy=Sherlock_LCINS.metadata$Tumor_Ploidy,
                                   gender=Sherlock_LCINS.metadata$gender,
                                   age_at_diagnosis=Sherlock_LCINS.metadata$age_at_diagnosis,
                                   stage=Sherlock_LCINS.metadata$stage,
                                   grade=Sherlock_LCINS.metadata$grade,
                                   passive_smoking=Sherlock_LCINS.metadata$passive_smoking,
                                   Histology=Sherlock_LCINS.metadata$Histology,
                                   SCNA_Cluster=Sherlock_LCINS.metadata$SCNA_Cluster,
                                   HLA_LOH=Sherlock_LCINS.metadata$HLA_LOH)

# Univariable models
lm_EGFR_GS = (lm(prob.EGFR~GS,data=Sherlock_LCINS_SBS_res))
lm_TP53_GS = (lm(prob.TP53~GS,data=Sherlock_LCINS_SBS_res))
```

We look at model diagnostics to determine if linear regression is a good fit
```{r}
par(mfrow=c(2,2))
plot(lm_EGFR_GS)
```
There is some structure in the residuals and deviations seen in qqplot, we will favor non-parametric models.
```{r}
Sherlock_LCINS_SBS_cor_EGFR_GS = cor.test(Sherlock_LCINS_SBS_res$prob.EGFR,Sherlock_LCINS_SBS_res$GS,method="spearman")
Sherlock_LCINS_SBS_cor_TP53_GS = cor.test(Sherlock_LCINS_SBS_res$prob.TP53,Sherlock_LCINS_SBS_res$GS,method="spearman")
```

We test covariables
```{r}
kw_LCINS_hist = kruskal.test(Sherlock_LCINS_SBS_res$prob.EGFR,Sherlock_LCINS_SBS_res$Histology,method="spearman") # signif
kw_LCINS_clust = kruskal.test(Sherlock_LCINS_SBS_res$prob.EGFR,Sherlock_LCINS_SBS_res$SCNA_Cluster,method="spearman") # signif

w_LCINS_SHS = wilcox.test(Sherlock_LCINS_SBS_res$prob.EGFR~Sherlock_LCINS_SBS_res$passive_smoking,method="spearman") # signif
w_LCINS_gender = wilcox.test(Sherlock_LCINS_SBS_res$prob.EGFR~Sherlock_LCINS_SBS_res$gender,method="spearman") # not signif
cor_LCINS_age = cor.test(Sherlock_LCINS_SBS_res$prob.EGFR,Sherlock_LCINS_SBS_res$age_at_diagnosis,method="spearman") # not signif

kw_LCINS_stage = kruskal.test(Sherlock_LCINS_SBS_res$prob.EGFR,Sherlock_LCINS_SBS_res$stage,method="spearman") # not signif
```

```{r}
kw_LCINS_hist.TP53 = kruskal.test(Sherlock_LCINS_SBS_res$prob.TP53,Sherlock_LCINS_SBS_res$Histology,method="spearman") # signif
kw_LCINS_clust.TP53 = kruskal.test(Sherlock_LCINS_SBS_res$prob.TP53,Sherlock_LCINS_SBS_res$SCNA_Cluster,method="spearman") # signif

w_LCINS_SHS.TP53 = wilcox.test(Sherlock_LCINS_SBS_res$prob.TP53~Sherlock_LCINS_SBS_res$passive_smoking,method="spearman") # signif
w_LCINS_gender.TP53 = wilcox.test(Sherlock_LCINS_SBS_res$prob.TP53~Sherlock_LCINS_SBS_res$gender,method="spearman") # not signif
cor_LCINS_age.TP53 = cor.test(Sherlock_LCINS_SBS_res$prob.TP53,Sherlock_LCINS_SBS_res$age_at_diagnosis,method="spearman") # not signif

kw_LCINS_stage.TP53 = kruskal.test(Sherlock_LCINS_SBS_res$prob.TP53,Sherlock_LCINS_SBS_res$stage,method="spearman") # not signif
```

Alternatively, to adjust for multiple covariables simultaneously we use permutations
```{r}
# Multivariable models adjusted for significant clinical variables (histology) and technical variables (purity)
Sherlock_LCINS_SBS_lmp_EGFR_GS_multi = lmerp(prob.EGFR~GS+Histology+Tumor_Purity,data=Sherlock_LCINS_SBS_res)$Results#only diversity and histology are significant
Sherlock_LCINS_SBS_lmp_TP53_GS_multi = lmerp(prob.TP53~GS+Histology+Tumor_Purity,data=Sherlock_LCINS_SBS_res)$Results#only diversity is significant

write_tsv(x = as.data.frame(Sherlock_LCINS_SBS_lmp_EGFR_GS_multi), file = "../../TableS_lmp_EGFR_GS_LCINS.tsv")
write_tsv(x = as.data.frame(Sherlock_LCINS_SBS_lmp_TP53_GS_multi), file = "../../TableS_lmp_TP53_GS_LCINS.tsv")

lmerp(prob.EGFR~passive_smoking*Histology+Tumor_Purity,data=Sherlock_LCINS_SBS_res)$Results#only diversity

```

## Mice exposed to carcinogens
```{r }
carcinogens_mice_SBS_res = tibble(prob.liver.Hras=prob_carcinogens_mice_drivers.liver.Hras,
                    prob.liver.Braf=prob_carcinogens_mice_drivers.liver.Braf,
                    prob.lung.Fgfr2=prob_carcinogens_mice_drivers.lung.Fgfr2,
                    prob.lung.Kras=prob_carcinogens_mice_drivers.lung.Kras,
                    Exposed = !str_detect(carcinogens_mice_SBS$Sample,"SPONTANEOUS"),
                    Chemical = carcinogens_mice_SBS$chemical,
                    Tissue=carcinogens_mice_SBS$Tissue , 
                    GS=carcinogens_mice_SBS_GS)
carcinogens_mice_SBS_res$Chemical[!carcinogens_mice_SBS_res$Exposed] = "None"
carcinogens_mice_SBS_res$Chemical = relevel(as.factor(carcinogens_mice_SBS_res$Chemical),ref = "None")

carcinogens_mice_SBS_cor_Hras_GS.liver = cor.test(carcinogens_mice_SBS_res[carcinogens_mice_SBS_res$Tissue%in%c("liver"),]$prob.liver.Hras,
                             carcinogens_mice_SBS_res[carcinogens_mice_SBS_res$Tissue%in%c("liver"),]$GS,method="spearman")
carcinogens_mice_SBS_cor_Braf_GS.liver = cor.test(carcinogens_mice_SBS_res[carcinogens_mice_SBS_res$Tissue%in%c("liver"),]$prob.liver.Braf,
                             carcinogens_mice_SBS_res[carcinogens_mice_SBS_res$Tissue%in%c("liver"),]$GS,method="spearman")

carcinogens_mice_SBS_cor_Fgfr2_GS.lung = cor.test(carcinogens_mice_SBS_res[carcinogens_mice_SBS_res$Tissue%in%c("lung"),]$prob.lung.Fgfr2,
                             carcinogens_mice_SBS_res[carcinogens_mice_SBS_res$Tissue%in%c("lung"),]$GS,method="spearman")
carcinogens_mice_SBS_cor_Kras_GS.lung  = cor.test(carcinogens_mice_SBS_res[carcinogens_mice_SBS_res$Tissue%in%c("lung"),]$prob.lung.Kras,
                             carcinogens_mice_SBS_res[carcinogens_mice_SBS_res$Tissue%in%c("lung"),]$GS,method="spearman")  
```

## ESCC across continents
```{r}
ESCC_countries_SBS_res = tibble(prob.TP53=prob_ESCC_TP53_drivers.pos,
                    prob.CDKN2A=prob_ESCC_CDKN2A_drivers.pos, 
                    prob.EP300=prob_ESCC_EP300_drivers.pos, 
                    prob.KMT2D=prob_ESCC_KMT2D_drivers.pos, 
                    prob.NFE2L2=prob_ESCC_NFE2L2_drivers.pos, 
                    prob.NOTCH1=prob_ESCC_NOTCH1_drivers.pos,
                    prob.PIK3CA=prob_ESCC_PIK3CA_drivers.pos, 
                    GS=GS_ESCC,
                    Country=mutprof_ESCC_SBS$Country,
                    Incidence_group=mutprof_ESCC_SBS$Incidence_Level)

cor_TP53_GS = cor.test(ESCC_countries_SBS_res$prob.TP53,ESCC_countries_SBS_res$GS,method="spearman") # no signif. increases in low, decreases in high
cor_CDKN2A_GS = cor.test(ESCC_countries_SBS_res$prob.CDKN2A,ESCC_countries_SBS_res$GS,method="spearman") # decreases overall, increases in low, decreases in high
cor_EP300_GS = cor.test(ESCC_countries_SBS_res$prob.EP300,ESCC_countries_SBS_res$GS,method="spearman") # increases in general
cor_KMT2D_GS = cor.test(ESCC_countries_SBS_res$prob.KMT2D,ESCC_countries_SBS_res$GS,method="spearman") # increases in general
cor_NFE2L2_GS = cor.test(ESCC_countries_SBS_res$prob.NFE2L2,ESCC_countries_SBS_res$GS,method="spearman") # increases in general
cor_NOTCH1_GS = cor.test(ESCC_countries_SBS_res$prob.NOTCH1,ESCC_countries_SBS_res$GS,method="spearman") # no signif. decreases in high, increases in low
cor_PIK3CA_GS = cor.test(ESCC_countries_SBS_res$prob.PIK3CA,ESCC_countries_SBS_res$GS,method="spearman") # increases in general

lmp_TP53_GS.I   = lmerp(prob.TP53~GS*Incidence_group,data=ESCC_countries_SBS_res)$Results # no signif. increases in low, decreases in high
lmp_CDKN2A_GS.I = lmerp(prob.CDKN2A~GS*Incidence_group,data=ESCC_countries_SBS_res)$Results # decreases overall, increases in low, decreases in high
lmp_EP300_GS.I  = lmerp(prob.EP300~GS*Incidence_group,data=ESCC_countries_SBS_res)$Results # increases in general
lmp_KMT2D_GS.I  = lmerp(prob.KMT2D~GS*Incidence_group,data=ESCC_countries_SBS_res)$Results # increases in general
lmp_NFE2L2_GS.I = lmerp(prob.NFE2L2~GS*Incidence_group,data=ESCC_countries_SBS_res)$Results # increases in general
lmp_NOTCH1_GS.I = lmerp(prob.NOTCH1~GS*Incidence_group,data=ESCC_countries_SBS_res)$Results # no signif. decreases in high, increases in low
lmp_PIK3CA_GS.I = lmerp(prob.PIK3CA~GS*Incidence_group,data=ESCC_countries_SBS_res)$Results # increases in general

wilcox.test(prob.TP53~Incidence_group,data=ESCC_countries_SBS_res)
wilcox.test(prob.CDKN2A~Incidence_group,data=ESCC_countries_SBS_res)
wilcox.test(prob.EP300~Incidence_group,data=ESCC_countries_SBS_res)
wilcox.test(prob.KMT2D~Incidence_group,data=ESCC_countries_SBS_res)
wilcox.test(prob.NFE2L2~Incidence_group,data=ESCC_countries_SBS_res)
wilcox.test(prob.NOTCH1~Incidence_group,data=ESCC_countries_SBS_res)
wilcox.test(prob.PIK3CA~Incidence_group,data=ESCC_countries_SBS_res)
```

# Plotting

## Relationship between within-sample diversity and probability of driver alteration
### LCINS
```{r }
gg_EGFR_GS <- ggplot(data=Sherlock_LCINS_SBS_res,aes(y=prob.EGFR,x=GS) ) + geom_point()+ stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + 
  annotate("text",x = 0.1,y=0.002,label=paste0("P=",format(Sherlock_LCINS_SBS_cor_EGFR_GS$p.value,digits=2)) ) + 
  #geom_point(alpha=0.1) + geom_point(data=MESOMICS_bootstrap_fava.res.mean,size=4) + stat_ellipse(level=0.90) + 
  xlab("within-sample diversity") + ylab("Probability of EGFR driver alteration") + theme_classic()

gg_TP53_GS <- ggplot(data=res.S,aes(y=prob.TP53,x=GS) ) + geom_point()+ stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + 
    annotate("text",x = 0.1,y=0.045,label=paste0("P=",format(Sherlock_LCINS_SBS_cor_TP53_GS$p.value,digits=2)) ) + 
  #geom_point(alpha=0.1) + geom_point(data=MESOMICS_bootstrap_fava.res.mean,size=4) + stat_ellipse(level=0.90) + 
  xlab("within-sample diversity") + ylab("Probability of TP53 driver alteration") + theme_classic()
```

### Mice exposed to carcinogens
```{r }
gg_RIVA_GS.liver.Hras <- ggplot(data=carcinogens_mice_SBS_res %>% filter(Tissue=="liver"),aes(y=prob.liver.Hras,x=GS) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + 
  annotate("text",x = 0.1,y=0.00125/10,label=paste0("P=",format(carcinogens_mice_SBS_cor_Hras_GS.liver$p.value,digits=2)) ) + 
  xlab("within-sample diversity") + ylab("Probability of Hras driver alteration") + theme_classic() + ggtitle("Liver")

gg_RIVA_GS.liver.Braf <- ggplot(data=carcinogens_mice_SBS_res %>% filter(Tissue==c("liver") ),aes(y=prob.liver.Braf,x=GS) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + 
  annotate("text",x = 0.1,y=0.00065/10,label=paste0("P=",format(carcinogens_mice_SBS_cor_Braf_GS.liver$p.value,digits=2)) ) + 
  xlab("within-sample diversity") + ylab("Probability of Braf driver alteration") + theme_classic() + ggtitle("Liver")

gg_RIVA_GS.lung.Fgfr2 <- ggplot(data=carcinogens_mice_SBS_res %>% filter(Tissue==c("lung") ),aes(y=prob.lung.Fgfr2,x=GS) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + 
  annotate("text",x = 0.2,y=0.0020,label=paste0("P=",format(carcinogens_mice_SBS_cor_Fgfr2_GS.lung$p.value,digits=2)) ) + 
  xlab("within-sample diversity") + ylab("Probability of Fgfr2 driver alteration") + theme_classic() + ggtitle("Lung")

gg_RIVA_GS.lung.Kras <- ggplot(data=carcinogens_mice_SBS_res %>% filter(Tissue==c("lung") ),aes(y=prob.lung.Kras,x=GS) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + 
  annotate("text",x = 0.2,y=0.0020/10,label=paste0("P=",format(carcinogens_mice_SBS_cor_Kras_GS.lung$p.value,digits=2)) ) + 
  xlab("within-sample diversity") + ylab("Probability of Kras driver alteration") + theme_classic() + ggtitle("Lung")


ggsave( gg_RIVA_GS.liver.Hras+ gg_RIVA_GS.liver.Braf + gg_RIVA_GS.lung.Fgfr2 + gg_RIVA_GS.lung.Kras ,
        filename = "../../Fig4c_mice_probs_draft.svg",height = 2.5*2,width = 3*2)
```

### LCINS
```{r }
col_incidence = c("Low"="#199cc9ff","High"="#d86600ff")

gg_ESCC_GS.TP53 <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.TP53,x=GS,col=Incidence_group) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + scale_color_manual(values=col_incidence)+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  xlab("within-sample diversity") + ylab("Probability of driver alteration") + theme_classic() + ggtitle(expression(italic(TP53)) )  + guides(col="none")

gg_ESCC_GS.CDKN2A <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.CDKN2A,x=GS,col=Incidence_group) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + scale_color_manual(values=col_incidence)+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  xlab("within-sample diversity") + ylab("") + theme_classic() + ggtitle(expression(CDKN2A)) + guides(col="none")

gg_ESCC_GS.EP300 <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.EP300,x=GS,col=Incidence_group) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + scale_color_manual(values=col_incidence)+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  xlab("within-sample diversity") + ylab("Probability of driver alteration") + theme_classic() + ggtitle(expression(EP300)) + guides(col="none")

gg_ESCC_GS.KMT2D <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.KMT2D,x=GS,col=Incidence_group) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + scale_color_manual(values=col_incidence)+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  xlab("within-sample diversity") + ylab("") + theme_classic() + ggtitle(expression(KMT2D)) + guides(col="none")

gg_ESCC_GS.NFE2L2 <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.NFE2L2,x=GS,col=Incidence_group) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + scale_color_manual(values=col_incidence)+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  xlab("within-sample diversity") + ylab("") + theme_classic() + ggtitle(expression(NFE2L2)) + guides(col="none")

gg_ESCC_GS.NOTCH1 <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.NOTCH1,x=GS,col=Incidence_group) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + scale_color_manual(values=col_incidence)+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  xlab("within-sample diversity") + ylab("") + theme_classic() + ggtitle(expression(NOTCH1)) + guides(col="none")

gg_ESCC_GS.PIK3CA <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.PIK3CA,x=GS,col=Incidence_group) ) + geom_point(alpha=0.3)+ 
  stat_smooth(method = "lm",formula = y ~ x,geom = "smooth") + scale_color_manual(values=col_incidence)+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  xlab("within-sample diversity") + ylab("") + theme_classic() + ggtitle(expression(PIK3CA)) + guides(col="none")

# association with country and incidence
ESCC_countries_SBS_res$Incidence_group = factor(ESCC_countries_SBS_res$Incidence_group,levels = c("Low","High"))

gg_ESCC_country.TP53 <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.TP53,x=Incidence_group,fill=Incidence_group) ) + geom_violin(col=NA)+  geom_boxplot(width=0.3,fill="white")+
  geom_signif(mapping = aes(y=prob.TP53,x=Incidence_group),comparisons = list(c("High","Low")),inherit.aes = F ,map_signif_level = T )+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  scale_fill_manual(values=col_incidence)+
  xlab("Incidence") + ylab("") + theme_classic() + ggtitle(expression(italic(TP53)) )  + guides(col="none",fill="none")

gg_ESCC_country.CDKN2A <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.CDKN2A,x=Incidence_group,fill=Incidence_group) ) + geom_violin(col=NA)+  geom_boxplot(width=0.3,fill="white")+
  geom_signif(mapping = aes(y=prob.CDKN2A,x=Incidence_group),comparisons = list(c("High","Low")),inherit.aes = F ,map_signif_level = T )+
  scale_fill_manual(values=col_incidence)+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  xlab("Incidence") + ylab("") + theme_classic() + ggtitle(expression(italic(CDKN2A)) )  + guides(col="none",fill="none")

gg_ESCC_country.EP300 <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.EP300,x=Incidence_group,fill=Incidence_group) ) + geom_violin(col=NA)+  geom_boxplot(width=0.3,fill="white")+
  geom_signif(mapping = aes(y=prob.EP300,x=Incidence_group),comparisons = list(c("High","Low")),inherit.aes = F ,map_signif_level = T )+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  scale_fill_manual(values=col_incidence)+
  xlab("Incidence") + ylab("") + theme_classic() + ggtitle(expression(italic(EP300)) )  + guides(col="none",fill="none")

gg_ESCC_country.PIK3CA <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.PIK3CA,x=Incidence_group,fill=Incidence_group) ) + geom_violin(col=NA)+  geom_boxplot(width=0.3,fill="white")+
  geom_signif(mapping = aes(y=prob.PIK3CA,x=Incidence_group),comparisons = list(c("High","Low")),inherit.aes = F ,map_signif_level = T )+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  scale_fill_manual(values=col_incidence)+
  xlab("Incidence") + ylab("") + theme_classic() + ggtitle(expression(italic(PIK3CA)) )  + guides(col="none",fill="none")

gg_ESCC_country.KMT2D <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.KMT2D,x=Incidence_group,fill=Incidence_group) ) + geom_violin(col=NA)+  geom_boxplot(width=0.3,fill="white")+
  geom_signif(mapping = aes(y=prob.KMT2D,x=Incidence_group),comparisons = list(c("High","Low")),inherit.aes = F ,map_signif_level = T )+
  #annotate("text",x = 0.1,y=0.00125,label=paste0("P=",format(lm_TP53_GS$coefficients[2,4],digits=2)) ) + 
  scale_fill_manual(values=col_incidence)+
  xlab("Incidence") + ylab("") + theme_classic() + ggtitle(expression(italic(KMT2D)) )  + guides(col="none",fill="none")

gg_ESCC_country.NFE2L2 <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.NFE2L2,x=Incidence_group,fill=Incidence_group) ) + geom_violin(col=NA)+  geom_boxplot(width=0.3,fill="white")+
  geom_signif(mapping = aes(y=prob.NFE2L2,x=Incidence_group),comparisons = list(c("High","Low")),inherit.aes = F ,map_signif_level = T )+
  scale_fill_manual(values=col_incidence)+
  xlab("Incidence") + ylab("") + theme_classic() + ggtitle(expression(italic(NFE2L2)) )  + guides(col="none",fill="none")

gg_ESCC_country.NOTCH1 <- ggplot(data=ESCC_countries_SBS_res,aes(y=prob.NOTCH1,x=Incidence_group,fill=Incidence_group) ) + geom_violin(col=NA)+  geom_boxplot(width=0.3,fill="white")+
  geom_signif(mapping = aes(y=prob.NOTCH1,x=Incidence_group),comparisons = list(c("High","Low")),inherit.aes = F ,map_signif_level = T )+
  scale_fill_manual(values=col_incidence)+
  xlab("Incidence") + ylab("") + theme_classic() + ggtitle(expression(italic(NOTCH1)) )  + guides(col="none",fill="none")

gg_ESCC_all = gg_ESCC_GS.TP53 + gg_ESCC_country.TP53+
  gg_ESCC_GS.CDKN2A + gg_ESCC_country.CDKN2A+
  gg_ESCC_GS.PIK3CA + gg_ESCC_country.PIK3CA+ 
  gg_ESCC_GS.KMT2D + gg_ESCC_country.KMT2D+
  gg_ESCC_GS.EP300  + gg_ESCC_country.EP300+ 
  gg_ESCC_GS.NFE2L2 + gg_ESCC_country.NFE2L2+ 
  gg_ESCC_GS.NOTCH1 + gg_ESCC_country.NOTCH1 +  plot_layout(ncol = 8)

ggsave(gg_ESCC_all,filename = "../../FigS_ESCC_drivers_raw.svg",height=3*2,width=3*8)
```


## Spectra of driver mutations

### LCINS
```{r}
EGFR_drivers_intogen_SBS96$EGFR_LUAD_intogen.norm = EGFR_drivers_intogen_SBS96$EGFR_LUAD_intogen/EGFR_context_counts_ordered

gg_EGFR_spectrum = ggplot(EGFR_drivers_intogen_SBS96,aes(x=paste0(Type,Subtype),y= EGFR_LUAD_intogen.norm,fill=Type) ) + geom_col() +
  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Mutation type") + ylab("Proportion of drivers")

TP53_drivers_intogen_SBS96$TP53_LUAD_intogen.norm = TP53_drivers_intogen_SBS96$TP53_LUAD_intogen/TP53_context_counts_ordered

gg_TP53_spectrum = ggplot(TP53_drivers_intogen_SBS96,aes(x=paste0(Type,Subtype),y= TP53_LUAD_intogen.norm,fill=Type) ) + geom_col() +
  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Mutation type") + ylab("Proportion of drivers")
```

### Mice exposed to carcinogens
```{r}
mutprof_carcinogens_mice_SBS.norm = mutprof_carcinogens_mice_SBS #/EGFR_context_counts_ordered

gg_Riva_drivers_spectrum = sigvar::plot_SBS_spectrum(tibble(Drivers=rowSums(mutprof_carcinogens_mice_SBS.norm[,-(1:3)])) )  + ylab("Proportion of drivers")
```

## Average spectra of low- and high-diversity samples

###
```{r}
library(ggrepel)
GSspectra = tibble(MutationType=paste0(MutType$Type,",",MutType$Subtype) , Type=MutType$Type, Subtype=MutType$Subtype,
       Proportion.lowGS  = Sherlock_MutProf_LUAD[which.min(GS_Sherlock_LUAD),],
       Proportion.highGS = Sherlock_MutProf_LUAD[which.max(GS_Sherlock_LUAD),] )

gg_lowGS_spectrum = ggplot(GSspectra,aes(x=MutationType,y= Proportion.lowGS,fill=Type) ) + 
  geom_col() + theme_classic()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Mutation type")+ ylab("Proportion of alterations") + ggtitle("Lowest diversity sample") + ylim(c(0,0.11))

SBSpie_lowGS = tibble(SBS=colnames(Sherlock_SBS),Proportions=Sherlock_SBS[which.min(GS_Sherlock_LUAD),])[Sherlock_SBS[which.min(GS_Sherlock_LUAD),]>0,]
SBSpie_lowGS$Pos = SBSpie_lowGS$Proportions/2+cumsum(c(0,SBSpie_lowGS$Proportions[-2]) )
SBSpie_lowGS$SBS = factor(SBSpie_lowGS$SBS,levels=rev(SBSpie_lowGS$SBS))

gg_lowGS_props = ggplot(SBSpie_lowGS, aes(x="",y=Proportions,fill=SBS) ) + 
  geom_bar(stat="identity", width=1, color="white") +  coord_polar("y", start=0) + 
  geom_label_repel(aes(y=Pos,label = SBS), nudge_x = 1, 
                   size = 3, show.legend = FALSE) + 
  theme_void() + scale_fill_manual(values = sbs_palette[]) + guides(fill="none")

# creating layout
layout <- c(
  area(t = 1, l = 1, b = 4, r = 6),
  area(t = 1, l = 5, b = 3, r = 6)
)

gg_lowGS_spectrum_props = gg_lowGS_spectrum + gg_lowGS_props + plot_layout(design = layout)


gg_highGS_spectrum = ggplot(GSspectra,aes(x=MutationType,y= Proportion.highGS,fill=Type) ) + 
  geom_col() + theme_classic()+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + xlab("Mutation type")+ ylab("Proportion of alterations") + ggtitle("Highest diversity sample") + ylim(c(0,0.11))

SBSpie_highGS = tibble(SBS=colnames(Sherlock_SBS),Proportions=Sherlock_SBS[which.max(GS_Sherlock_LUAD),])[Sherlock_SBS[which.max(GS_Sherlock_LUAD),]>0,]
SBSpie_highGS$Pos = SBSpie_highGS$Proportions/2+cumsum(c(0,SBSpie_highGS$Proportions[-6]) )
SBSpie_highGS$SBS = factor(SBSpie_highGS$SBS,levels=rev(SBSpie_highGS$SBS))

gg_highGS_props = ggplot(SBSpie_highGS, aes(x="",y=Proportions,fill=SBS) ) + 
  geom_col(width=1, color="white") +  coord_polar("y",start=0) + 
  geom_label_repel(aes(y=Pos,label = SBS), nudge_x = 1, 
                   size = 3, show.legend = FALSE,label.padding = 0.1,box.padding = 0.1,force = 5) + 
  theme_void() + scale_fill_manual(values = sbs_palette[]) + guides(fill="none")

gg_highGS_spectrum_props = gg_highGS_spectrum + gg_highGS_props + plot_layout(design = layout)
```

## Association with Riva et al. driver results

```{r}
driver.tib = left_join(bind_cols(sample=rownames(Riva_SBS),Riva_SBS,GS=GS_Riva),drivers)
driver.tib = left_join(driver.tib,mice_metadata,by=c(sample="Sample"))
driver.tib$chemical[str_detect(driver.tib$sample,"SPONTANEOUS")] = "spontaneous"

library(ggbeeswarm)

#summary( lm(GS~Tissue.x+!(signature=="mSBS1"|signature=="mSBS5"|signature=="mSBS40"),data = driver.tib %>% filter(Tissue.x%in%c("lung","liver")) ) )

driver.tib$signature = factor(driver.tib$signature,levels=c("mSBS1","mSBS5","mSBS40","mSBS12","mSBS17","mSBS18","mSBS19","mSBS_N1"))

driver.tib.liver = driver.tib %>% filter(!is.na(driver.tib$signature ),Tissue.x=="LIVER") %>% group_by(GS_group=GS>=median(GS),signature) %>% summarize(n=n()) %>% ungroup() %>% group_by(GS_group) %>% mutate(Activity=n/sum(n))

gg_drivers_riva_mut.liver = ggplot(driver.tib.liver, aes(x=GS_group,y=Activity, fill=signature)) + geom_col() + 
  geom_segment(data = driver.tib.liver[2,],aes(x=1.5,xend=2.5,y=1-Activity,yend=1-Activity),col="white",linewidth=2) + 
  scale_fill_manual(values=sbs_palette) + theme_classic() + ylab("Mean activity") + scale_y_continuous(limits = c(0,1))

driver.tib.lung = driver.tib %>% filter(!is.na(driver.tib$signature ),Tissue.x=="LUNG") %>% group_by(GS_group=GS>=median(GS),signature) %>% summarize(n=n()) %>% ungroup() %>% group_by(GS_group) %>% mutate(Activity=n/sum(n))

gg_drivers_riva_mut.lung  = ggplot(driver.tib.lung, aes(x=GS_group,y=Activity,fill=signature)) + geom_col() + 
  geom_segment(data = driver.tib.lung %>% filter(signature %in% c("mSBS1","mSBS5","mSBS40")) %>% summarize(Activity=sum(Activity)),aes(x=0:1 + .5,xend=0:1+1.5,y=1-Activity,yend=1-Activity),col="white",linewidth=2,inherit.aes = F) + 
  scale_fill_manual(values=sbs_palette) + theme_classic() + scale_y_continuous(limits = c(0,1))

ggsave( gg_drivers_riva_mut.liver+ gg_drivers_riva_mut.lung ,filename = "../../Fig4a_draft.svg",h=3,w=3*2)

## diversity of responsible signatures
driver.tib.liver = driver.tib %>% filter(!is.na(driver.tib$signature ),Tissue.y=="liver") %>% group_by(GS>=median(GS),signature) %>% summarize(n=n()) %>% 
  ungroup() %>% pivot_wider(names_from=signature,values_from = n,values_fill = 0) 
fisher.test( as.matrix(driver.tib.liver[,-1]) ) 
#age vs other
fisher.test( cbind(driver.tib.liver[,2],rowSums(driver.tib.liver[,3:5])) ) 

driver.tib.lung  = driver.tib %>% filter(!is.na(driver.tib$signature ),Tissue.y=="lung") %>% group_by(GS>=median(GS),signature) %>% summarize(n=n()) %>% 
  ungroup() %>% pivot_wider(names_from=signature,values_from = n,values_fill = 0)

fisher.test( as.matrix(driver.tib.lung[,-1]) )
#age vs other
fisher.test( cbind(rowSums(driver.tib.lung[,2:4]),rowSums(driver.tib.lung[,5:7])) ) 

## diversity
driver.tib.lung.props  = sweep(driver.tib.lung[,-1],1,rowSums(driver.tib.lung[,-1]),"/")
driver.tib.liver.props = sweep(driver.tib.liver[,-1],1,rowSums(driver.tib.liver[,-1]),"/")

div.drivers.lung.lowGS = FAVA::gini_simpson_mean(driver.tib.lung.props[1,],S =SBS_mice_S_cossim[colnames(driver.tib.lung.props),colnames(driver.tib.lung.props)] )
div.drivers.lung.highGS = FAVA::gini_simpson_mean(driver.tib.lung.props[2,],S =SBS_mice_S_cossim[colnames(driver.tib.lung.props),colnames(driver.tib.lung.props)] )

div.drivers.liver.lowGS = FAVA::gini_simpson_mean(driver.tib.liver.props[1,],S =SBS_mice_S_cossim[colnames(driver.tib.liver.props),colnames(driver.tib.liver.props)] )
div.drivers.liver.highGS = FAVA::gini_simpson_mean(driver.tib.liver.props[2,],S =SBS_mice_S_cossim[colnames(driver.tib.liver.props),colnames(driver.tib.liver.props)] )

div.drivers.tib =tibble(Diversity=c(div.drivers.lung.lowGS,div.drivers.lung.highGS,div.drivers.liver.lowGS,div.drivers.liver.highGS),
       Tissue=c("lung","lung","liver","liver"),WS_diversity.group=factor(rep(c("Low","High"),2) ,levels=c("Low","High")) )

ggdivdiv = ggplot(div.drivers.tib,aes(x=WS_diversity.group,y=Diversity)) + geom_point() + geom_path(group=1) + facet_wrap(.~Tissue)  +
  theme_classic() + xlab("Within-sample diversity") + ylab("Diversity of responsible signatures")


ggsave( ggdivdiv ,filename = "../../Fig4b_divdiv_draft.svg",h=3,w=3*2)

##### 
driversigs = ggplot(driver.tib[str_detect(driver.tib$sample,"LIVER"),], aes(x=!str_detect(sample,"SPONT"),y=GS)) + geom_violin() + geom_beeswarm(aes(col=signature)) + coord_flip() + theme_classic() + ylab("Within-sample diversity") + xlab("Exposure")

ggplot(driver.tib[str_detect(driver.tib$sample,"LIVER"),], aes(x=signature,y=GS)) + geom_violin() + geom_beeswarm(aes(col=signature)) + coord_flip() + theme_classic() + ylab("Within-sample diversity") + xlab("Exposure")

ggplot(driver.tib[str_detect(driver.tib$sample,"LUNG"),], aes(x=!str_detect(sample,"SPONT"),y=GS)) + 
  geom_violin() + geom_beeswarm(aes(col=signature)) + coord_flip() + theme_classic()

ggplot(driver.tib[str_detect(driver.tib$sample,"LUNG"),], aes(x=!str_detect(sample,"SPONT"),y=GS)) + 
  geom_violin() + geom_beeswarm(aes(col=signature)) + coord_flip() + theme_classic()

ggplot(driver.tib[str_detect(driver.tib$sample,"LIVER"),], aes(x=gene,y=GS,col=!str_detect(sample,"SPONTANEOUS"))) + geom_boxplot() # diverse spontaneous are more likely to have a driver gene

ggplot(driver.tib[str_detect(driver.tib$sample,"LUNG"),], aes(x=gene,y=GS,col=!str_detect(sample,"SPONTANEOUS"))) + geom_boxplot() # diverse spontaneous are more likely to have a driver gene


glm_drivers_GS = glm(!is.na(gene)~GS+Tissue + !str_detect(sample,"SPONTANEOUS"),
                     family=binomial(link='logit'), data = driver.tib %>% filter(Tissue%in%c("lung","liver")) )
summary(glm_drivers_GS)

summary( lm(GS~Tissue+gene + !str_detect(sample,"SPONTANEOUS"),data = driver.tib %>% filter(Tissue%in%c("lung","liver")) ) )

```

## Assembling all panels
```{r }
(gg_EGFR_GS + (gg_EGFR_spectrum + ggtitle("EGFR driver mutations"))  + gg_lowGS_spectrum_props +  gg_TP53_GS + (gg_TP53_spectrum+ggtitle("TP53 driver mutations")) + gg_highGS_spectrum_props ) +  plot_annotation(tag_levels = 'a') + plot_layout(widths = c(1, 2,2)) & theme(plot.tag = element_text(face = 'bold'))

```

## Save tables
```{r }
TableS_drivers.LCINS = res.S
colnames(TableS_drivers.LCINS)[1:2] = c("Probability_EGFR_driver","Probability_TP53_driver")
colnames(TableS_drivers.LCINS)[3] = c("Within-sample_diversity")
TableS_drivers.LCINS = bind_cols(Subject=Sherlock.metadata$Subject,TableS_drivers.LCINS)

write_tsv(TableS_drivers.LCINS,file = "../../TableS_drivers_LCINS.tsv")


TableS_drivers.Riva = carcinogens_mice_SBS_res
colnames(TableS_drivers.Riva)[1:4] = c("Probability_Hras_driver","Probability_Braf_driver",
                                  "Probability_Fgfr2_driver","Probability_Kras_driver")
colnames(TableS_drivers.Riva)[8] = c("Within-sample_diversity")
TableS_drivers.Riva = bind_cols(Sample=mutsig_carcinogens_mice_SBS$Sample,TableS_drivers.Riva)

write_tsv(TableS_drivers.Riva,file = "../../TableS_drivers_Riva.tsv")

TableS_drivers.ESCC = ESCC_countries_SBS_res
colnames(TableS_drivers.ESCC)[1:7] = c("Probability_TP53_driver","Probability_CDKN2A_driver",
                                  "Probability_EP300_driver","Probability_KMT2D_driver",
                                  "Probability_NFE2L2_driver","Probability_NOTCH1_driver",
                                  "Probability_PIK3CA_driver")
colnames(TableS_drivers.ESCC)[8] = c("Within-sample_diversity")
TableS_drivers.ESCC = bind_cols(Sample=mutprof_ESCC_SBS$Sample,TableS_drivers.ESCC)

write_tsv(TableS_drivers.ESCC,file = "../../TableS_drivers_ESCC.tsv")
```

# Session information

```{r }
sessionInfo()
```
